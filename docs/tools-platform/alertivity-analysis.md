# Alertivity 系统监控工具分析

## 项目概述

Alertivity 是一款 macOS 菜单栏系统监控工具，专注于实时采样 CPU、内存、磁盘和网络数据，帮助用户及时发现系统异常。它将系统健康状态归纳为 Normal（正常）、Elevated（警告）、Critical（严重）三个等级，高亮显示触发当前状态的指标，并提供对问题进程的快速操作。

| 项目信息 | 详情 |
|---------|------|
| **项目名称** | Alertivity |
| **作者** | nobbbbby |
| **开源协议** | GPL-3.0 |
| **GitHub Stars** | 137 |
| **主要技术** | Swift 5 / SwiftUI / Xcode 15+ |
| **平台要求** | macOS 13.0+ |
| **发布渠道** | Mac App Store |

## 核心功能特性

### 1. 实时系统监控

Alertivity 每隔几秒对系统进行一次采样，监控以下核心指标：

| 指标 | 监控内容 | 默认阈值 |
|------|---------|---------|
| **CPU** | 处理器使用率 | <50% 正常 / 50-79% 警告 / ≥80% 严重 |
| **内存** | 内存使用量 | <70% 正常 / 70-84% 警告 / ≥85% 严重 |
| **磁盘** | 磁盘吞吐量（读写合计） | <30 MB/s 正常 / 30-119 MB/s 警告 / ≥120 MB/s 严重 |
| **网络** | 网络吞吐量（发送接收合计） | <5 MB/s 正常 / 5-19 MB/s 警告 / ≥20 MB/s 严重 |

**技术特点：**
- 采用轻量级滞后机制（light hysteresis）避免状态频繁跳动
- 整体状态由所有指标中最高严重等级决定
- 状态变化平滑过渡，减少干扰

### 2. 菜单栏指示器

菜单栏图标可以配置为显示不同内容：

| 显示模式 | 说明 |
|---------|------|
| **整体状态** | 用颜色表示当前系统健康状态（绿/黄/红） |
| **单一指标** | 仅显示 CPU、内存、磁盘或网络图标 |
| **自动切换** | 仅在严重状态时自动切换到最繁忙指标 |
| **仅严重显示** | 正常状态下隐藏图标，严重时显示 |

**自动切换逻辑：**
- 仅在 Critical 严重状态时触发
- 优先级顺序：CPU > Memory > Disk > Network
- 需要连续两次采样确认后才切换，避免误判

### 3. 紧凑菜单界面

点击菜单栏图标展开的菜单包含：

- **状态摘要**：显示当前系统状态及触发指标
- **指标详情**：CPU、内存、磁盘百分比，网络吞吐量
- **高活动进程**：CPU/内存/网络高占用进程列表（磁盘进程被排除以避免采样延迟）
- **快速操作**：
  - 在 Activity Monitor 中定位进程
  - 强制终止进程

### 4. 智能通知系统

当系统状态达到临界值时发送通知：

| 通知类型 | 触发条件 |
|---------|---------|
| **状态临界通知** | 任意指标在配置时长内保持严重状态 |
| **进程活动通知** | 进程 CPU ≥80% 或内存 ≥25% 持续 60 秒（可配置） |

**通知特性：**
- 包含触发指标和具体数值
- 显示问题进程元数据
- 自动节流避免通知轰炸

### 5. 设置选项

| 设置分类 | 可配置项 |
|---------|---------|
| **外观** | Dock 图标显示/隐藏、启动时登录 |
| **菜单图标** | 默认图标类型、自动切换、仅严重时显示、显示指标图标 |
| **通知** | 启用通知、临界状态持续时长 |
| **检测阈值** | CPU 百分比、内存百分比阈值 |
| **进程检测**（非沙盒版） | 高活动进程 CPU/内存阈值、持续时长 |

## 构建版本对比

Alertivity 提供两个构建版本：

| 特性 | App Store 版本（沙盒） | 非沙盒版本 |
|------|----------------------|-----------|
| **进程采样** | ❌ 不可用 | ✅ 可用 |
| **检测标签页** | ❌ 隐藏 | ✅ 显示 |
| **进程通知** | ❌ 仅状态临界 | ✅ 状态临界 + 进程活动 |
| **进程阈值配置** | ❌ 不可配置 | ✅ 可配置 CPU/内存阈值 |
| **分发方式** | Mac App Store | 直接安装 |

**选择建议：**
- 普通用户：使用 App Store 版本，安装简单，权限要求低
- 高级用户：使用非沙盒版本，获得完整进程监控和自定义功能

## 技术架构分析

### 技术栈

| 层级 | 技术选型 | 说明 |
|------|---------|------|
| **UI 框架** | SwiftUI | 现代声明式 UI 框架 |
| **语言** | Swift 5 | Apple 官方推荐语言 |
| **构建工具** | Xcode 15+ | Apple IDE |
| **启动管理** | SMAppService | macOS 13+ 启动登录支持 |
| **进程操作** | AppleScript + System Events | 与 Activity Monitor 集成 |
| **测试框架** | Swift Testing + XCUITest | Apple 官方测试框架 |

### 测试覆盖

Alertivity 注重代码质量，拥有完整的测试体系：

```
测试命令：
xcodebuild -project Alertivity.xcodeproj \
  -scheme 'Alertivity (Non-sandboxed)' \
  -testPlan Alertivity \
  -destination 'platform=macOS' \
  -enableCodeCoverage YES test
```

**测试金字塔：**
- **单元测试**：约 12 倍于集成测试
- **集成测试**：核心功能集成验证
- **UI 冒烟测试**：通过测试窗口验证菜单和通知设置

**代码覆盖率：** 测试结果生成于 `.xcresult` 包中，可通过 Xcode 或命令行分析。

### 项目结构

```
Alertivity/
├── Alertivity/           # 主应用代码
├── AlertivityTests/      # 单元测试
├── AlertivityUITests/    # UI 测试
├── Alertivity.xcodeproj/ # Xcode 项目文件
├── openspec/             # OpenSpec 规范文档
├── img/                  # 截图资源
├── AGENTS.md             # AI 助手指令
├── LICENSE               # GPL-3.0 许可证
└── README.md             # 项目说明
```

### OpenSpec 集成

Alertivity 采用 OpenSpec 规范管理项目：

- **变更提案**：所有重大变更通过 OpenSpec 提案流程
- **技术规范**：重要技术决策记录在 `openspec/` 目录
- **AI 协作**：`AGENTS.md` 定义了 AI 助手的工作流程

## 使用场景分析

### 适用人群

| 用户类型 | 使用价值 |
|---------|---------|
| **开发者** | 监控开发过程中 CPU/内存飙升，快速定位问题进程 |
| **设计师** | 观察设计软件（如 Figma、Sketch）的资源占用情况 |
| **系统管理员** | 远程监控多台 Mac 的系统健康状态 |
| **普通用户** | 了解电脑运行状态，及时发现异常 |
| **游戏玩家** | 监控游戏时的系统负载和温度趋势 |

### 典型使用场景

**场景 1：开发调试**
```
背景：开发大型项目时，编译或构建过程可能导致 CPU 飙升
使用方式：设置 CPU ≥80% 通知，及时发现资源密集型任务
优势：比打开 Activity Monitor 更便捷，菜单栏即可查看
```

**场景 2：内存泄漏检测**
```
背景：应用程序存在内存泄漏，长时间运行后内存持续增长
使用方式：监控内存使用百分比，设置 ≥85% 警告阈值
优势：自动记录触发进程，帮助定位问题应用
```

**场景 3：网络监控**
```
背景：需要监控大文件上传下载的网络带宽占用
使用方式：菜单栏显示网络吞吐量，查看实时带宽使用
优势：比系统网络偏好设置更直观，实时更新
```

**场景 4：远程服务器管理**
```
背景：管理多台 Mac 服务器，需要集中监控系统状态
使用方式：每台服务器安装 Alertivity，通过菜单快速检查
优势：轻量级，不会显著增加系统负担
```

### 与系统工具对比

| 工具 | 优点 | 缺点 |
|------|------|------|
| **Activity Monitor** | 系统自带，功能全面 | 需要打开多个窗口，信息分散 |
| **top/htop 命令行** | 高效，可脚本化 | 学习曲线陡峭，不直观 |
| **iStatMenus** | 界面美观，功能丰富 | 付费软件，功能复杂 |
| **Alertivity** | 轻量级，菜单栏集成，免费开源 | 功能相对简单，仅 macOS |

## 安装与配置

### 安装方式

| 方式 | 步骤 |
|------|------|
| **Mac App Store** | [点击安装](https://apps.apple.com/app/alertivity/id6756399719) |
| **源码编译** | 1. 克隆仓库 2. Xcode 打开项目 3. 选择 Non-sandboxed scheme 运行 |

### 首次启动配置

1. **Dock 图标**：选择显示或隐藏
2. **启动登录**：启用开机自启动
3. **通知权限**：允许系统通知

### 推荐配置方案

**方案 1：开发者日常使用**
```
菜单图标：自动切换
显示模式：仅严重时显示图标
CPU 阈值：80% 严重
内存阈值：85% 严重
通知：启用
进程检测：CPU ≥80% 持续 60s
```

**方案 2：系统监控看板**
```
菜单图标：显示整体状态
显示模式：始终显示
CPU 阈值：70% 严重
内存阈值：80% 严重
通知：启用
进程检测：全部启用
```

**方案 3：轻量级监控**
```
菜单图标：显示 CPU
显示模式：仅严重时显示
CPU 阈值：90% 严重
内存阈值：90% 严重
通知：禁用
```

## 隐私与权限说明

### 权限要求

| 权限 | 用途 | 必要程度 |
|------|------|---------|
| **辅助功能** | AppleScript 调用 System Events，在 Activity Monitor 中定位进程 | 可选（影响快速定位功能） |
| **通知** | 发送系统状态和进程活动通知 | 可选（影响通知功能） |
| **启动登录** | macOS 13+ SMAppService 注册 | 可选（影响开机自启动） |

### 权限配置路径

1. **辅助功能**：`系统设置 > 隐私与安全性 > 辅助功能` > 勾选 Alertivity
2. **通知**：`系统设置 > 通知` > 找到 Alertivity > 启用通知
3. **启动登录**：应用内设置或 `系统设置 > 通用 > 登录项`

### 隐私保护

- **本地处理**：所有监控数据在本地处理，不上传云端
- **沙盒版本**：App Store 版本运行在沙盒中，权限受限更安全
- **开源透明**：GPL-3.0 协议，代码公开可审查

## 与类似工具对比

### 系统监控工具生态

| 工具 | 类型 | 价格 | 开源 | 特点 |
|------|------|------|------|------|
| **Alertivity** | 菜单栏 App | 免费 | ✅ | 轻量级，专注核心监控 |
| **iStatMenus** | 菜单栏 App | $12/年 | ❌ | 功能丰富，界面美观 |
| **Stats** | 菜单栏 App | 免费 | ✅ | 开源，功能全面 |
| **Activity Monitor** | 系统工具 | 免费 | ❌ | 系统自带，功能基础 |
| **htop** | 命令行 | 免费 | ✅ | 高效，可脚本化 |

### 选择建议

**选择 Alertivity 如果：**
- ✅ 只需要核心的系统监控功能
- ✅ 偏好简洁的菜单栏交互
- ✅ 希望使用免费开源软件
- ✅ 需要与 AI 协作开发（OpenSpec 集成）

**选择 iStatMenus 如果：**
- ✅ 愿意付费获得更丰富功能
- ✅ 需要详细的图表和历史数据
- ✅ 希望高度自定义界面

**选择 Stats 如果：**
- ✅ 需要开源替代品
- ✅ 需要更多监控指标（电池、风扇等）
- ✅ 偏好 SwiftUI 以外的技术栈

## 开发与扩展

### 二次开发

Alertivity 采用 SwiftUI 和 Swift 5 构建，适合二次开发：

**添加新监控指标：**
1. 在 `SystemMonitor.swift` 中添加新指标采样方法
2. 更新 `StatusCalculator` 中的阈值判断逻辑
3. 在菜单视图中添加新指标显示
4. 添加对应的设置选项

**自定义主题：**
1. 修改 `Theme.swift` 中的颜色配置
2. 更新 Assets 中的图标资源
3. 在设置中添加主题选择器

### 构建命令

**Debug 构建：**
```bash
xcodebuild -scheme 'Alertivity (Non-sandboxed)' \
  -configuration Debug \
  -destination 'platform=macOS' build
```

**Release 构建：**
```bash
xcodebuild -scheme 'Alertivity (Non-sandboxed)' \
  -configuration Release \
  -destination 'platform=macOS' build
```

**测试运行：**
```bash
xcodebuild -project Alertivity.xcodeproj \
  -scheme 'Alertivity (Non-sandboxed)' \
  -testPlan Alertivity \
  -destination 'platform=macOS' \
  -enableCodeCoverage YES test
```

### OpenSpec 工作流

Alertivity 使用 OpenSpec 进行项目管理：

```
openspec/
├── AGENTS.md           # AI 助手指令
├── specs/              # 技术规范文档
│   ├── PROPOSAL-001-xxx.md
│   └── ...
└── tasks/              # 实现任务
    └── TASK-001-xxx.md
```

**贡献流程：**
1. 创建 Issue 描述功能需求
2. 编写 OpenSpec 提案（规格说明）
3. 获得社区认可后实现
4. 提交 PR，通过测试和代码审查

## 项目活跃度

| 指标 | 数值 |
|------|------|
| **GitHub Stars** | 137 |
| **Forks** | 3 |
| **Commits** | 42 |
| **最近更新** | 活跃维护中 |
| **Issues** | 少量开放中 |

**版本历史：**
- v1.0.x：初始版本发布
- v1.1.x：功能增强和 Bug 修复
- 最新版本可通过 GitHub Releases 查看

## 优缺点总结

### 优点

✅ **轻量级**：菜单栏应用，系统资源占用小
✅ **专注核心**：只做系统监控，功能精简
✅ **开源免费**：GPL-3.0 协议，无隐藏成本
✅ **美观界面**：SwiftUI 构建，界面现代简洁
✅ **智能通知**：状态临界和进程活动双重通知
✅ **配置灵活**：多种显示模式和阈值配置
✅ **测试完善**：完整测试覆盖，代码质量高
✅ **OpenSpec 集成**：适合 AI 协作开发

### 缺点

❌ **仅 macOS**：不支持 Windows 或 Linux
❌ **功能单一**：缺少历史图表、历史数据存储
❌ **沙盒限制**：App Store 版本功能受限
❌ **社区较小**：137 stars，社区规模有限
❌ **无中文界面**：目前仅支持英文界面
❌ **依赖 Xcode**：开发和编译需要 macOS 和 Xcode

## 使用建议

### 新手快速上手

1. 从 Mac App Store 安装
2. 首次启动允许通知权限
3. 根据需求调整阈值设置
4. 熟悉菜单栏图标的不同显示模式

### 进阶使用

1. 下载非沙盒版本获得完整功能
2. 配置辅助功能权限使用进程快速定位
3. 自定义高活动进程的检测阈值
4. 结合 OpenSpec 参与项目贡献

### 最佳实践

- **日常监控**：启用启动登录，保持后台运行
- **问题排查**：发现异常时查看菜单中的进程列表
- **预防为主**：设置合适的阈值，在问题发生前获得通知
- **隐私优先**：使用沙盒版本减少权限要求

## 相关资源

| 资源 | 链接 |
|------|------|
| **GitHub 仓库** | [https://github.com/nobbbbby/Alertivity](https://github.com/nobbbbby/Alertivity) |
| **Mac App Store** | [https://apps.apple.com/app/alertivity/id6756399719](https://apps.apple.com/app/alertivity/id6756399719) |
| **项目文档** | README.md / openspec/ |
| **许可证** | GPL-3.0 |
| **技术栈** | Swift 5 / SwiftUI / Xcode 15+ |

## 总结

Alertivity 是一款设计精良的 macOS 系统监控工具，专注于提供简洁、高效的系统健康监控体验。其核心优势包括：

1. **轻量简洁**：菜单栏集成，不占用桌面空间
2. **智能通知**：及时发现系统异常，不打扰正常操作
3. **开源透明**：代码公开，可自由修改和分发
4. **质量保证**：完善测试覆盖，代码质量高
5. **AI 友好**：OpenSpec 集成，适合现代开发工作流

对于需要实时监控系统状态但又不想被复杂工具淹没的 macOS 用户，Alertivity 是一个值得考虑的选择。
